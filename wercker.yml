# Start with Oracle Linux 7
box: oraclelinux:7-slim


# This is the build pipeline. Pipelines are the core of wercker
# Read more about pipelines on our dev center
# https://devcenter.wercker.com/development/pipelines/
build:
  # https://devcenter.wercker.com/development/steps/
  steps:
    - script:
        name: create keyfile
        code: |
          echo "round 0"
          echo $OCIAPIKEY_PRIVATE
          echo $OCIAPIKEY_PRIVATE > temp.pem

    - internal/docker-build:
        build-args: "OCIUSEROCID=$OCIUSEROCID OCIAPIKEYFP=$OCIAPIKEYFP OKEY=$OCIAPIKEY_PRIVATE OCITENANTOCID=$OCITENANTOCID OCIOKEOCID=$OCIOKEOCID"
        dockerfile: Dockerfile
        image-name: okegetkube

    - internal/docker-push:
        username: $DOCKER_USER
        password: $DOCKER_PASSWORD
        repository: $DOCKER_REPO
        registry: $DOCKER_REGISTRY
        tag: $WERCKER_GIT_COMMIT
        ports: 8081
        cmd: "/bin/bash"
